<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	  th:replace="~{base::layout(~{::section})}">
<head>
	<meta charset="UTF-8">
	<title>All Products</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<section>
	<div class="container-fluid mt-4 p-3">
		<div class="row">
			<div class="col-12 mb-3 text-center">
				<h2 class="fw-bold">All Products</h2>
				<hr>
			</div>

			<div class="col-12 mb-3">
				<a href="/admin/" class="btn btn-outline-secondary">
					<i class="fa-solid fa-arrow-left"></i> Back
				</a>
			</div>

			<!-- Session Messages -->
			<div th:if="${session.succMsg}" class="alert alert-success text-center alert-dismissible fade show" role="alert">
				[[${session.succMsg}]]
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
				<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
			</div>
			<div th:if="${session.errorMsg}" class="alert alert-danger text-center alert-dismissible fade show" role="alert">
				[[${session.errorMsg}]]
				<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
				<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
			</div>

			<!-- Search Form -->
			<div class="col-md-6 offset-md-3 mb-4">
				<form th:action="@{/admin/products}" method="get" class="d-flex">
					<input type="text" class="form-control me-2 rounded" name="ch" th:value="${param.ch}" placeholder="Search by Title or Category...">
					<button type="submit" class="btn btn-primary">Search</button>
				</form>
			</div>

			<!-- Product Table -->
			<div class="col-12">
				<div class="table-responsive">
					<table class="table table-hover align-middle text-center caption-top">
						<thead class="table-light">
						<tr>
							<th scope="col">#</th>
							<th scope="col">Image</th>
							<th scope="col">Title</th>
							<th scope="col">Category</th>
							<th scope="col" class="text-center">Price</th>
							<th scope="col">Discount</th>
							<th scope="col" class="text-center">Discount Price</th>
							<th scope="col">Status</th>
							<th scope="col">Stock</th>
							<th scope="col">Action</th>
						</tr>
						</thead>
						<tbody>
						<tr th:if="${products.isEmpty()}">
							<td colspan="10" class="text-center text-muted fst-italic py-4">No products found.</td>
						</tr>
						<tr th:each="p, iterStat : ${products}" th:unless="${products.isEmpty()}">
							<th scope="row">[[${pageNo * pageSize + iterStat.count}]]</th>
							<td>
								<img th:src="@{'/img/product_img/' + ${p.image}}" width="60" height="60" class="rounded img-thumbnail"> <!-- Giảm size, thêm thumbnail -->
							</td>
							<td class="text-start">[[${p.title}]]</td>
							<td>[[${p.category}]]</td>
							<td class="text-center price-cell">[[${#numbers.formatDecimal(p.price, 0, 'COMMA', 0, 'POINT')}]] ₫</td>
							<td>[[${p.discount}]]%</td>
							<td class="text-center price-cell fw-bold">[[${#numbers.formatDecimal(p.discountPrice, 0, 'COMMA', 0, 'POINT')}]] ₫</td>
							<td>
								<span th:if="${p.isActive}" class="badge bg-success">Active</span>
								<span th:unless="${p.isActive}" class="badge bg-secondary">Inactive</span>
							</td>
							<td>[[${p.stock}]]</td>
							<td>
								<div class="d-flex justify-content-center gap-2">
									<a th:href="@{/admin/editProduct/{id}(id=${p.id}, pageNo=${pageNo}, ch=${param.ch})}" class="btn btn-sm btn-primary" title="Edit">
										<i class="fa-solid fa-pen-to-square"></i> <span class="visually-hidden">Edit</span>
									</a>
									<a th:href="@{'/admin/deleteProduct/' + ${p.id}}" class="btn btn-sm btn-danger" title="Delete"
									   onclick="return confirm('Are you sure you want to delete this product?');">
										<i class="fa-solid fa-trash"></i> <span class="visually-hidden">Delete</span>
									</a>
								</div>
							</td>
						</tr>
						</tbody>
					</table>
				</div>

				<div class="row align-items-center mt-4 pt-3 border-top">
					<div class="col-md-4 text-center text-md-start mb-2 mb-md-0">
						<span class="text-muted small">Total Products: [[${totalElements}]]</span>
					</div>
					<div class="col-md-4 d-flex justify-content-center">
						<nav aria-label="Page navigation">
							<ul class="pagination  mb-0">
								<!-- Previous -->
								<li class="page-item" th:classappend="${isFirst} ? 'disabled'">
									<a class="page-link"
									   th:href="${!isFirst} ? @{/admin/products(pageNo=${pageNo-1}, ch=${param.ch})} : '#'"
									   aria-label="Previous"
									   th:attr="aria-disabled=${isFirst} ? 'true' : 'false'"
									   th:styleappend="${isFirst} ? 'pointer-events: none;' : ''">
										<i class="fas fa-angle-left"></i>
									</a>
								</li>

								<li th:each="i : ${#numbers.sequence(1, totalPages)}"
									class="page-item"
									th:classappend="${pageNo+1 == i} ? 'active'">
									<a class="page-link" th:href="@{/admin/products(pageNo=${i-1}, ch=${param.ch})}">
										[[${i}]]
									</a>
								</li>

								<!-- Next -->
								<li class="page-item" th:classappend="${isLast} ? 'disabled'">
									<a class="page-link"
									   th:href="${!isLast} ? @{/admin/products(pageNo=${pageNo+1}, ch=${param.ch})} : '#'"
									   aria-label="Next"
									   th:attr="aria-disabled=${isLast} ? 'true' : 'false'"
									   th:styleappend="${isLast} ? 'pointer-events: none;' : ''">
										<i class="fas fa-angle-right"></i>
									</a>
								</li>
							</ul>
						</nav>
					</div>
					<div class="col-md-4"></div>
				</div>

			</div>
		</div>
	</div>
</section>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>