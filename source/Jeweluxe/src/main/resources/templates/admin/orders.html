<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{base::layout(~{::section})}">
<head>
	<meta charset="ISO-8859-1">
	<title>Orders Management</title>
</head>
<body>
<section>
	<div class="container mt-5">
		<div class="row">
			<div class="col-12 text-center mb-4">
				<h2 class="fw-bold">All Orders</h2>
				<hr class="w-25 mx-auto">
			</div>

			<div class="col-12 mb-3">
				<a href="/admin/" class="btn btn-outline-primary">
					<i class="fa-solid fa-arrow-left"></i> Back
				</a>
			</div>

			<!-- Success Message -->
			<div class="col-12" th:if="${succMsg}">
				<div class="alert alert-success text-center fw-bold" role="alert">
					[[${succMsg}]]

				</div>
			</div>

			<!-- Error Message -->
			<div class="col-12" th:if="${errorMsg}">
				<div class="alert alert-danger text-center fw-bold" role="alert">
					[[${errorMsg}]]
				</div>
			</div>

			<div class="col-12">
				<div class="table-responsive shadow rounded">
					<table class="table table-hover align-middle">
						<thead class="table-light">
						<tr class="text-center">
							<th>Deliver Details</th>
							<th>Date</th>
							<th>Product Details</th>
							<th>Price</th>
							<th>Status</th>
							<th>Action</th>
						</tr>
						</thead>
						<tbody>
						<!-- Khi có search -->
						<th:block th:if="${srch}">
							<th:block th:if="${orderDtls!=null}">
								<tr>
									<td>
										<strong>Name:</strong> [[${orderDtls.orderAddress.firstName + ' ' + orderDtls.orderAddress.lastName}]]<br>
										<strong>Email:</strong> [[${orderDtls.orderAddress.email}]]<br>
										<strong>Mobile:</strong> [[${orderDtls.orderAddress.mobileNo}]]<br>
										<strong>Address:</strong> [[${orderDtls.orderAddress.address}]]<br>
										<strong>City:</strong> [[${orderDtls.orderAddress.city}]]<br>
										<strong>State:</strong> [[${orderDtls.orderAddress.state}]], [[${orderDtls.orderAddress.pincode}]]
									</td>
									<td class="text-center">[[${orderDtls.orderDate}]]</td>
									<td class="text-center">[[${orderDtls.product.title}]]</td>
									<td>
										Quantity: [[${orderDtls.quantity}]]<br>
										Price: [[${orderDtls.price}]]<br>
										Total: [[${orderDtls.quantity * orderDtls.price}]]
									</td>
									<td class="text-center">
										<span th:classappend="${orderDtls.status == T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).DELIVERED ? 'bg-success' : (orderDtls.status == T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).CANCELLED ? 'bg-danger' : 'bg-warning')}"
											  class="badge">
                                            [[${orderDtls.status.name}]]
                                        </span>
									</td>
									<td class="text-center align-middle">
										<div class="d-flex flex-column gap-1">
											<form th:if="${orderDtls.status == T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).ORDER_RECEIVED}"
												  th:action="@{/admin/pack-order}" method="post" class="d-grid">
												<input type="hidden" name="id" th:value="${orderDtls.id}" />
												<button type="submit" class="btn btn-info btn-sm">Pack</button>
											</form>
											<form th:if="${orderDtls.status == T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).PRODUCT_PACKED}"
												  th:action="@{/admin/ship-order}" method="post" class="d-grid">
												<input type="hidden" name="id" th:value="${orderDtls.id}" />
												<button type="submit" class="btn btn-warning btn-sm">Ship</button>
											</form>
											<form th:if="${orderDtls.status == T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).OUT_FOR_DELIVERY}"
												  th:action="@{/admin/deliver-order}" method="post" class="d-grid">
												<input type="hidden" name="id" th:value="${orderDtls.id}" />
												<button type="submit" class="btn btn-success btn-sm">Deliver</button>
											</form>
											<form th:if="${orderDtls.status != T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).DELIVERED and orderDtls.status != T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).CANCELLED}"
												  th:action="@{/admin/cancel-order}" method="post" class="d-grid"
												  onsubmit="return confirm('Are you sure you want to cancel this order item?');"> <!-- Thêm xác nh?n -->
												<input type="hidden" name="id" th:value="${orderDtls.id}" />
												<button type="submit" class="btn btn-danger btn-sm">Cancel</button>
											</form>
										</div>
									</td>
								</tr>
							</th:block>
							<th:block th:unless="${orderDtls!=null}">
								<tr>
									<td colspan="6" class="text-center text-danger fs-4">Order not found or Error.</td>
								</tr>
							</th:block>
						</th:block>

						<!-- Khi không search -->
						<th:block th:unless="${srch}">
							<tr th:each="o : ${orders}">
								<td>
									<strong>Name:</strong> [[${o.orderAddress.firstName + ' ' + o.orderAddress.lastName}]]<br>
									<strong>Email:</strong> [[${o.orderAddress.email}]]<br>
									<strong>Mobile:</strong> [[${o.orderAddress.mobileNo}]]<br>
									<strong>Address:</strong> [[${o.orderAddress.address}]]<br>
									<strong>City:</strong> [[${o.orderAddress.city}]]<br>
									<strong>State:</strong> [[${o.orderAddress.state}]], [[${o.orderAddress.pincode}]]
								</td>
								<td class="text-center">[[${o.orderDate}]]</td>
								<td class="text-center">[[${o.product.title}]]</td>
								<td>
									Quantity: [[${o.quantity}]]<br>
									Price: [[${o.price}]]<br>
									Total: [[${o.quantity * o.price}]]
								</td>
								<td class="text-center">
									<span th:classappend="${o.status == T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).DELIVERED ? 'bg-success' : (o.status == T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).CANCELLED ? 'bg-danger' : 'bg-warning')}"
										  class="badge">
                                        [[${o.status.name}]]
                                    </span>
								</td>
								<td class="text-center align-middle">
									<div class="d-flex flex-column gap-1">
										<form th:if="${o.status == T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).IN_PROGRESS}"
											  th:action="@{/admin/receive-order}" method="post" class="d-grid">
											<input type="hidden" name="id" th:value="${o.id}" />
											<button type="submit" class="btn btn-primary btn-sm">Receive</button>
										</form>
										<!-- Nút Pack -->
										<form th:if="${o.status == T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).ORDER_RECEIVED}"
											  th:action="@{/admin/pack-order}" method="post" class="d-grid">
											<input type="hidden" name="id" th:value="${o.id}" />
											<button type="submit" class="btn btn-info btn-sm">Pack</button>
										</form>
										<!-- Nút Ship -->
										<form th:if="${o.status == T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).PRODUCT_PACKED}"
											  th:action="@{/admin/ship-order}" method="post" class="d-grid">
											<input type="hidden" name="id" th:value="${o.id}" />
											<button type="submit" class="btn btn-warning btn-sm">Ship</button>
										</form>
										<!-- Nút Deliver -->
										<form th:if="${o.status == T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).OUT_FOR_DELIVERY}"
											  th:action="@{/admin/deliver-order}" method="post" class="d-grid">
											<input type="hidden" name="id" th:value="${o.id}" />
											<button type="submit" class="btn btn-success btn-sm">Deliver</button>
										</form>
										<!-- Nút Cancel -->
										<form th:if="${o.status != T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).DELIVERED and
										   o.status != T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).CANCELLED and
										   o.status != T(com.tdtu.DesignPattern.Jeweluxe.util.OrderStatus).OUT_FOR_DELIVERY}"
													  th:action="@{/admin/cancel-order}" method="post" class="d-grid"
													  onsubmit="return confirm('Are you sure you want to cancel this order item?');">
													<input type="hidden" name="id" th:value="${o.id}" />
													<button type="submit" class="btn btn-danger btn-sm">Cancel</button>
										</form>
									</div>
								</td>
							</tr>
						</th:block>
						</tbody>
					</table>
				</div>

				<!-- Pagination -->
				<th:block th:if="${!srch}">
					<div class="row mt-4 align-items-center">
						<div class="col-md-4 fw-bold">
							Total Orders: [[${totalElements}]]
						</div>
						<div class="col-md-8">
							<nav aria-label="Page navigation">
								<ul class="pagination justify-content-end">
									<li class="page-item" th:classappend="${isFirst} ? 'disabled' : ''">
										<a class="page-link" th:href="@{'/admin/orders?pageNo='+${pageNo-1}}" aria-label="Previous">
											<span aria-hidden="true">&laquo;</span>
										</a>
									</li>

									<li th:each="i : ${#numbers.sequence(1, totalPages)}"
										class="page-item" th:classappend="${pageNo+1==i} ? 'active' : ''">
										<a class="page-link" th:href="@{'/admin/orders?pageNo='+${i-1}}">[[${i}]]</a>
									</li>

									<li class="page-item" th:classappend="${isLast} ? 'disabled' : ''">
										<a class="page-link" th:href="@{'/admin/orders?pageNo='+${pageNo+1}}" aria-label="Next">
											<span aria-hidden="true">&raquo;</span>
										</a>
									</li>
								</ul>
							</nav>
						</div>
					</div>
				</th:block>

			</div>
		</div>
	</div>
</section>
</body>
</html>
