<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="~{base::layout(~{::section})}">
<head>
	<meta charset="UTF-8">
	<title>Checkout - Jeweluxe</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
<section>
	<div class="container py-5">
		<div class="row mb-5">
			<div class="col-12 text-center">
				<h2 class="text-primary fw-bold border-bottom pb-2 d-inline-block">Complete Your Order</h2>
			</div>
		</div>

		<div th:if="${session.errorMsg}" class="alert alert-danger alert-dismissible fade show" role="alert">
			[[${session.errorMsg}]]
			<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
			<th:block th:text="${@commnServiceImpl.removeSessionMessage()}"></th:block>
		</div>

		<form th:action="@{/user/save-order}" method="post" id="checkoutForm" novalidate>
			<div class="row g-4">

				<div class="col-lg-7">
					<div class="card shadow-sm rounded-4">
						<div class="card-body">
							<h5 class="fw-bold text-primary mb-4">Shipping Information</h5>
							<div class="row g-3">
								<div class="col-md-6">
									<label for="firstName" class="form-label">First Name *</label>
									<input type="text" class="form-control" id="firstName" name="firstName" required>
								</div>
								<div class="col-md-6">
									<label for="lastName" class="form-label">Last Name *</label>
									<input type="text" class="form-control" id="lastName" name="lastName" required>
								</div>
								<div class="col-12">
									<label for="email" class="form-label">Email *</label>
									<input type="email" class="form-control" id="email" name="email" required placeholder="you@example.com">
								</div>
								<div class="col-12">
									<label for="mobileNo" class="form-label">Mobile Number *</label>
									<input type="tel" class="form-control" id="mobileNo" name="mobileNo" required placeholder="09xxxxxxxx">
								</div>
								<div class="col-12">
									<label for="address" class="form-label">Address *</label>
									<input type="text" class="form-control" id="address" name="address" required placeholder="Street Address, Ward, District">
								</div>
								<div class="col-md-6">
									<label for="city" class="form-label">City / Province *</label>
									<input type="text" class="form-control" id="city" name="city" required>
								</div>
								<div class="col-md-3">
									<label for="state" class="form-label">State / Region</label>
									<input type="text" class="form-control" id="state" name="state">
								</div>
								<div class="col-md-3">
									<label for="pincode" class="form-label">Pincode</label>
									<input type="text" class="form-control" id="pincode" name="pincode">
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="col-lg-5">
					<div class="card shadow-sm rounded-4 position-sticky top-0">
						<div class="card-body">
							<h5 class="fw-bold text-dark mb-4">Order Summary</h5>

							<div th:if="${#lists.isEmpty(carts)}" class="alert alert-warning text-center small">
								Your cart is empty. Please add items to proceed.
							</div>

							<div th:each="cart : ${carts}" th:if="${not #lists.isEmpty(carts)}" class="mb-3 border-bottom pb-3 d-flex align-items-center">
								<img th:src="@{'/img/product_img/' + ${cart.product.image}}" class="rounded me-3" width="60" height="60" alt="Product">
								<div class="flex-grow-1">
									<div class="fw-semibold">[[${cart.quantity}]] x [[${cart.product.title}]]</div>
									<div class="text-muted small">
										<th:block th:if="${cart.wantsGiftWrap}"><i class="fas fa-gift text-success me-1"></i>Gift Wrap</th:block>
										<th:block th:if="${cart.wantsInsurance}"><i class="fas fa-shield-alt text-info me-1"></i>Insurance</th:block>
									</div>
								</div>
								<div class="fw-bold text-primary ms-2">[[${#numbers.formatCurrency(cart.decoratedPrice)}]]</div>
							</div>

<!--							<div th:if="${not #lists.isEmpty(carts)}" class="pt-3 mt-3 border-top">-->
<!--								<div class="d-flex justify-content-between mb-2 text-muted">-->
<!--									<span>Subtotal</span>-->
<!--									<span>[[${#numbers.formatCurrency(subtotal)}]]</span>-->
<!--								</div>-->
<!--								<div class="d-flex justify-content-between mb-2 text-muted">-->
<!--									<span>Shipping</span>-->
<!--									<span>[[${#numbers.formatCurrency(shippingFee)}]]</span>-->
<!--								</div>-->
<!--								<div class="d-flex justify-content-between mt-3 pt-3 border-top fs-5 fw-bold">-->
<!--									<span>Total</span>-->
<!--									<span class="text-primary">[[${#numbers.formatCurrency(totalAmount)}]]</span>-->
<!--								</div>-->
<!--							</div>-->
							<div class="price-breakdown" th:if="${not #lists.isEmpty(carts)}">
								<div class="price-line">
									<span>Subtotal</span>
									<span>[[${#numbers.formatCurrency(subTotal)}]]</span>
								</div>
								<div class="price-line">
									<span>Shipping <small class="text-muted" th:if="${shippingDescription != 'N/A'}">([[${shippingDescription}]])</small></span>
									<span>[[${#numbers.formatCurrency(shippingFee)}]]</span>
								</div>
								<div class="price-line" th:if="${taxFee > 0}">
									<span>Tax</span>
									<span>[[${#numbers.formatCurrency(taxFee)}]]</span>
								</div>
								<div class="grand-total-line">
									<span>Grand Total</span>
									<span>[[${#numbers.formatCurrency(grandTotal)}]]</span>
								</div>
							</div>

							<div class="mt-4">
								<button type="submit" class="btn btn-success btn-lg w-100 fw-bold">Place Order</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</form>
	</div>
</section>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
