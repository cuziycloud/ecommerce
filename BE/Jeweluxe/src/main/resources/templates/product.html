<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	  th:replace="~{base::layout(~{::section})}">
<head>
	<meta charset="UTF-8">
	<title>Products</title>
	<style>
		.category-sidebar .card {
			background-color: #ffffff;
		}
		.category-sidebar .card-header {
			padding: 0.75rem 1rem;
		}
		.category-sidebar .list-group-item {
			padding: 0.6rem 1rem;
			font-size: 0.9rem;
			transition: background-color 0.2s ease, color 0.2s ease;
			font-weight: 500;
		}
		.category-sidebar .list-group-item i.fa-fw {
			width: 18px;
			text-align: center;
		}
		.category-sidebar .list-group-item:not(.active-category):hover {
			background-color: #f8f9fa;
			color: var(--bs-primary);
		}
		.category-sidebar .list-group-item.active-category {
			background-color: var(--bs-primary);
			color: white;
			font-weight: 600;
		}
		.category-sidebar .list-group-item.active-category i {
			color: white !important;
		}
		.category-sidebar .list-group-item .small {
			font-size: 0.8em;
		}

		/* --- Search Bar --- */
		.search-toolbar {
			background-color: #f8f9fa;
			padding: 1.5rem 0;
			margin-bottom: 5rem;
			border-bottom: 1px solid #dee2e6;
		}

		.search-form-alt .form-control {
			border-radius: 50rem 0 0 50rem;
			padding: 1.6rem 1.2rem;
		}
		.search-form-alt .form-control::placeholder {
			 color: rgba(255, 255, 255, 0.6);
		}
		.search-form-alt .form-control:focus {
			background-color: #495057;
			color: #ffffff;
			border-color: var(--bs-primary);
			box-shadow: 0 0 0 0.2rem rgba(var(--bs-primary-rgb), 0.25);
		}

		.search-form-alt .btn-search {
			border-radius: 0 50rem 50rem 0;
			padding: 0.6rem 1.2rem;
			background-color: var(--bs-primary);
			border-color: var(--bs-primary);
			color: white;
			font-weight: 500;
			transition: background-color 0.2s ease, border-color 0.2s ease;
		}
		.search-form-alt .btn-search:hover {
			background-color: #0b5ed7;
			border-color: #0a58ca;
		}
	</style>
</head>
<body>
<section class="pt-5">

	<!-- Thanh Tìm kiếm -->
	<div class="container-fluid search-toolbar">
		<div class="container">
			<div class="row">
				<div class="col-md-8 offset-md-2 col-lg-6 offset-lg-3"> <!-- Thu hẹp lại chút -->
					<form th:action="@{/products}" method="get" class="input-group search-form-alt">
						<input type="hidden" name="category" th:value="${paramValue}">
						<input type="search" class="form-control" name="ch" th:value="${param.ch}" placeholder="Search products..." aria-label="Search Products">
						<button class="btn btn-search" type="submit" id="button-search">
							<i class="fa-solid fa-magnifying-glass"></i>
						</button>
					</form>
				</div>
			</div>
		</div>
	</div>

	<!-- Danh mục và Sản phẩm -->
	<div class="container-fluid mt-4">
		<div class="row">

			<!--  Danh mục (Sidebar) -->
			<aside class="col-lg-2 col-md-3 category-sidebar">
				<div class="card border-0 shadow-sm mb-4">
					<div class="card-header bg-transparent border-bottom px-3 py-2">
						<h6 class="mb-0 fw-semibold text-uppercase small">
							<i class="fas fa-tags fa-fw me-2 text-muted"></i>Categories
						</h6>
					</div>
					<div class="list-group list-group-flush px-2 py-2">
						<a th:href="@{/products(ch=${param.ch})}"
						class="list-group-item list-group-item-action border-0 rounded-1 mb-1"
						th:classappend="${paramValue == null || paramValue == ''} ? 'active-category' : 'text-secondary'"> <!-- Dùng class riêng & text-secondary -->
						<i class="fas fa-layer-group fa-fw me-2"></i> All Products
						</a>
						<a th:each="c : ${categories}"
						   th:href="@{/products(category=${c.name}, ch=${param.ch})}"
						class="list-group-item list-group-item-action border-0 rounded-1 mb-1"
						th:classappend="${paramValue == c.name} ? 'active-category' : 'text-secondary'">
						[[${c.name}]]
						</a>
					</div>
				</div>
		</aside>

			<!-- Sản phẩm -->
			<div class="col-md-10">

				<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">

					<th:block th:if="${products != null && !products.isEmpty()}">
						<div class="col" th:each="p : ${products}">
							<div class="card h-100 shadow-sm">
								<a th:href="@{'/product/'+${p.id}}" class="text-decoration-none">
									<img th:src="@{'/img/product_img/'+${p.image}}" class="card-img-top"
										 th:alt="${p.title}"
										 style="height: 200px; object-fit: contain; padding-top: 10px;">
								</a>
								<div class="card-body d-flex flex-column">
									<h5 class="card-title">
										<a th:href="@{'/product/'+${p.id}}" class="text-dark text-decoration-none stretched-link">
											[[${p.title}]]
										</a>
									</h5>

									<div class="mt-auto">
										<div class="d-flex justify-content-between align-items-center mb-2">
											<span class="fw-bold fs-5 text-primary">$[[${p.discountPrice}]]</span>
											<span th:if="${p.discount > 0}" class="badge bg-danger rounded-pill">[[${p.discount}]]% OFF</span> <!-- rounded-pill cho đẹp hơn -->
										</div>
										<p th:if="${p.discount > 0}" class="card-text text-muted text-decoration-line-through mb-2 small">
											Original: $[[${p.price}]]
										</p>

										<!-- Nút View Details -->
										<div class="d-grid">
											<a th:href="@{'/product/'+${p.id}}" class="btn btn-sm btn-outline-primary">View Details</a> <!-- btn-outline-primary nhẹ nhàng hơn -->
										</div>
									</div>
								</div>
							</div>
						</div>
					</th:block>

					<th:block th:unless="${products != null && !products.isEmpty()}">
						<div class="col-12">
							<p class="fs-4 text-center mt-5 text-danger">Product not available</p>
						</div>
					</th:block>
				</div>

				<!-- Phân trang -->
				<div class="row mt-4" th:if="${totalPages > 1}">
					<div class="col-md-6 text-md-start text-center mb-2">
						<span class="text-muted">Showing [[${currentPageElements}]] of [[${totalElements}]] products</span>
					</div>
					<div class="col-md-6 d-flex justify-content-md-end justify-content-center">
						<nav aria-label="Page navigation">
							<ul class="pagination">
								<!-- Nút Previous -->
								<li class="page-item" th:classappend="${isFirst} ? 'disabled' : ''">
									<a class="page-link" th:href="@{/products(pageNo=${pageNo-1}, category=${paramValue}, ch=${param.ch})}" aria-label="Previous">
										<span aria-hidden="true">«</span>
									</a>
								</li>

								<!-- Các trang số - Chỉ hiển thị một khoảng trang giới hạn -->
								<li class="page-item" th:each="i : ${#numbers.sequence(1, totalPages)}" th:if="${i >= pageNo - 1 && i <= pageNo + 3}" th:classappend="${pageNo + 1 == i} ? 'active' : ''">
									<a class="page-link" th:href="@{/products(pageNo=${i-1}, category=${paramValue}, ch=${param.ch})}">[[${i}]]</a>
								</li>

								<li class="page-item disabled" th:if="${pageNo + 3 < totalPages}">
									<span class="page-link">...</span>
								</li>
								<li class="page-item" th:if="${pageNo + 3 < totalPages}">
									<a class="page-link" th:href="@{/products(pageNo=${totalPages-1}, category=${paramValue}, ch=${param.ch})}">[[${totalPages}]]</a>
								</li>


								<!-- Nút Next -->
								<li class="page-item" th:classappend="${isLast} ? 'disabled' : ''">
									<a class="page-link" th:href="@{/products(pageNo=${pageNo+1}, category=${paramValue}, ch=${param.ch})}" aria-label="Next">
										<span aria-hidden="true">»</span>
									</a>
								</li>
							</ul>
						</nav>
					</div>
				</div>

			</div>
		</div>
	</div>

</section>
</body>
</html>